###go_image_server
这是一个用go语言写的实时图片服务器
有如下特性
1.动态处理图片。在请求的url上加上不同的尺寸参数就可以得到不同的尺寸的图片。
2.链式图片处理。对一个图片进行多重处理，这和unix的pipeline很类似。
3.高性能。得益于go语言的并发特性，此图片服务器的内存，cpu占用都很低，能同时处理的图片数量也很可观。
4.webp图片格式支持。webp比之于jpeg，能更好的压缩图片的存储和传输体积，这点对移动应用尤为重要。
5.部署简单，只有一个可执行文件，不依赖任何外部运行库，只需将可执行文件拷贝到服务器即可执行。
6.支持多种输出格式和输出质量。当前能够支持jpeg，gif，png，bmp，webp格式，对于jpeg，gif，webp还能够支持自定义输出图片质量。



###示例
原图如下
http://45.78.62.199:12345/2830dfa89daaf37b13c3421b7807df27

动态剪裁的例子
动态剪裁成400*400的图如下，当然高宽值可以设置成我们需要的任意值
http://45.78.62.199:12345/2830dfa89daaf37b13c3421b7807df27?c=fill&w=400&h=400

链式处理的例子
可以把图片裁剪成400*400后，还可以进行灰度处理。如下
[http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1?c=fit&w=200&h=300|c=grayscale](http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1?c=fit&w=200&h=300|c=grayscale "pipeline")


webp处理的例子
可以把图片裁剪成400*400后，还可以进行灰度处理。如下
http://45.78.62.199:12345/2830dfa89daaf37b13c3421b7807df27?c=webp&q=50



###未来开发路线图

1.~~支持自定义输出格式和格式质量，比如输出jpg，png，gif~~。
2.~~支持webp格式。webp格式压缩的图片尺寸更小~~。
3.增加后端分布式存储。当前版本只支持本地文件系统存储，只能利用单台机器的存储能力。
4.增加安全性。对于恶意攻击增加防御能力。



###文档。
##1.安装及运行
下载对应版本的可执行文件：windows64，linux64
直接执行即可


##2.图片上传
curl  --data-binary @test.jpg "http://http://45.78.62.199:12345/upload"
其中test.jpg是需要上传的文件，这个对应于http中的binary的post上传，windows平台下可以用postman来模拟。
可以得到如下结果。
{"md5":"b59fe5a3cd71bc28e39e444cd955fcb1","msg":"ok"}
md5就是文件对应的MD5码，系统也是用这个来定位上传的文件。

访问该文件方法如下
http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1

##3.图片操作
每一个图片操作就是一个处理命令，命令有0个或者多个参数，参数包含参数名和参数值。参数是以url的参数的方式放在url尾部。即？后面就是参数。
命令名称用c表示，命令的值在下面的表中找。
例如
http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1?c=fit&w=200&h=300
上面的命令表示对图片进行压缩，使图片能够容纳在一个200*300的框内。命令本身参数名是c，值是fit。fit命令包含两个参数h，w分别表示高和宽。


命令之间可以通过管道链接符号“|”把多个命令连接起来实现多重操作。
例如
[http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1?c=fit&w=200&h=300|c=grayscale](http://45.78.62.199:12345/b59fe5a3cd71bc28e39e444cd955fcb1?c=fit&w=200&h=300|c=grayscale "pipeline")
上面表示先推图像进行fit压缩操作，然后对操作后的结果进行灰度化 处理。





命令列表

### 表格
| 命令名称  |参数      | 例子  |
| :-------- | --------:| :--:  |
| fit       |w:宽(int)<br/>h:高(int) |  c=fit&w=100&h=300  <br/>保持图片本身的比例，压缩图片尺寸，使其能容纳到100*300的方框内，框的上下或者左右可能会有空白。|
| fill      |w:宽(int)<br/>h:高(int) |  c=fill&w=100&h=300  <br/>保持图片本身的比例，压缩图片尺寸，使其能填充满到100*300的方框，图片的上下或者左右会被裁剪掉。|
| resize    |w:宽(int)<br/>h:高(int) | c=fill&w=100&h=300 <br/>不保持图片本身的比例，压缩图片尺寸|
| gamma     |s:强度(float) | 234  |
| contrast  |s:强度(int) | c=contrast&s=20   增加对比度|
| brightness|s:强度(float) | c=brightness&s=0.5   增加亮度  |
| grayscale |   无| c=grayscale 变成灰度图  |
| invert    |   无|c=invert 反相  |
| blur      |   s:强度(float)  | c=blur&s=3.5   |
| sharpen   |   s:强度(float)  | c=sharpen&s=3.5    |
| rotate90  |    无 | c=rotate90 正向旋转90度  |
| rotate180 |    无 | c=rotate180正向旋转180度  |
| rotate270 |    无 | c=rotate270正向旋转270度    |
| flipH     |    无 | c=flipH水平翻转  |
| flipV     |    无 | c=flipV垂直翻转  |
| webp      |    q:图片质量,可选,默认50(int) | c=webp&q=80  用80%的质量输出成webp格式|
| jpeg      |    q:图片质量,可选,默认80(int)  | c=jpeg&q=80  用80%的质量输出成jpeg格式 |
| png       |    无 | c=png  输出成png格式 |
| gif       |    q:颜色数量 | c=png&q=128  输出成128色的gif格式 |
